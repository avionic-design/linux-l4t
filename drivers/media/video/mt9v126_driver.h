/*
 * Definitions for the MT9V126 CMOS Image Sensor from Aptina
 *
 * Copyright (C) 2010-2013, Alban Bedel <alban.bedel@avionic-design.de>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

#ifndef _MT9V126_DRIVER_H
#define _MT9V126_DRIVER_H

/* Core registers */
#define MT9V126_MODEL_ID				0x3000
#define MT9V126_Y_ADDR_START				0x3002
#define MT9V126_X_ADDR_START				0x3004
#define MT9V126_Y_ADDR_END				0x3006
#define MT9V126_X_ADDR_END				0x3008
#define MT9V126_FRAME_LENGTH_LINES			0x300A
#define MT9V126_LINE_LENGTH_PCK				0x300C
#define MT9V126_FINE_CORRECTION				0x3010
#define MT9V126_COARSE_INTEGRATION_TIME			0x3012
#define MT9V126_FINE_INTEGRATION_TIME			0x3014
#define MT9V126_RESET_REGISTER				0x301A
#define MT9V126_DATA_PEDESTAL				0x301E
#define MT9V126_SOFTWARE_RESET				0x3020
#define MT9V126_GROUPED_PARAMETER_HOLD			0x3022
#define MT9V126_PIXEL_ORDER				0x3024
#define MT9V126_GPI_STATUS				0x3026
#define MT9V126_DIGITAL_GAIN_GREENR			0x3032
#define MT9V126_DIGITAL_GAIN_RED			0x3034
#define MT9V126_DIGITAL_GAIN_BLUE			0x3036
#define MT9V126_DIGITAL_GAIN_GREENB			0x3038
#define MT9V126_FRAME_STATUS				0x303C
#define MT9V126_READ_MODE				0x3040
#define MT9V126_GREEN1_GAIN				0x3056
#define MT9V126_BLUE_GAIN				0x3058
#define MT9V126_RED_GAIN				0x305A
#define MT9V126_GREEN2_GAIN				0x305C
#define MT9V126_GLOBAL_GAIN				0x305E
#define MT9V126_TEST_PATTERN_MODE			0x3070
#define MT9V126_TEST_DATA_RED				0x3072
#define MT9V126_TEST_DATA_GREENR			0x3074
#define MT9V126_TEST_DATA_BLUE				0x3076
#define MT9V126_TEST_DATA_GREENB			0x3078
#define MT9V126_X_EVEN_INC				0x30A0
#define MT9V126_X_ODD_INC				0x30A2
#define MT9V126_Y_EVEN_INC				0x30A4
#define MT9V126_Y_ODD_INC				0x30A6
#define MT9V126_FUSE_ID1				0x31F4
#define MT9V126_FUSE_ID2				0x31F6
#define MT9V126_FUSE_ID3				0x31F8
#define MT9V126_FUSE_ID4				0x31FA

/* SOC1 Registers */
#define MT9V126_COLOR_PIPELINE_CONTROL			0x3210
#define MT9V126_FIRST_COLOR				0x3254
#define MT9V126_APERTURE_PARAMETERS_2D			0x326C
#define MT9V126_LOW_PASS_YUV_FILTER			0x326E
#define MT9V126_THRESHOLD_FOR_Y_FILTER_R_CHANNEL	0x3270
#define MT9V126_THRESHOLD_FOR_Y_FILTER_G_CHANNEL	0x3272
#define MT9V126_THRESHOLD_FOR_Y_FILTER_B_CHANNEL	0x3274
#define MT9V126_BLACK_LEVEL_TO_CCM			0x3276
#define MT9V126_RED_OFFSET				0x327A
#define MT9V126_GREEN1_OFFSET				0x327C
#define MT9V126_GREEN2_OFFSET				0x327E
#define MT9V126_BLUE_OFFSET				0x3280
#define MT9V126_RED_OFFSET_TO_CCM			0x32BA
#define MT9V126_GREEN_OFFSET_TO_CCM			0x32BC
#define MT9V126_BLUE_OFFSET_TO_CCM			0x32BE
#define MT9V126_CCM_EXP_LOW_BYTE			0x32C0
#define MT9V126_CCM_EXP_HIGH_BYTE			0x32C2
#define MT9V126_CCM_ELEMENTS_1_AND_2			0x32C4
#define MT9V126_CCM_ELEMENTS_3_AND_4			0x32C6
#define MT9V126_CCM_ELEMENTS_5_AND_6			0x32C8
#define MT9V126_CCM_ELEMENTS_7_AND_8			0x32CA
#define MT9V126_CCM_ELEMENTS_9_AND_SIGNS		0x32CC
#define MT9V126_OUTPUT_FORMAT_CONFIGURATION		0x332E
#define MT9V126_OUTPUT_FORMAT_TEST			0x3330
#define MT9V126_FM_LINE_COUNT				0x3332
#define MT9V126_FM_FRAME_COUNT				0x3334
#define MT9V126_YUV_YCBCR_CONTROL			0x337C
#define MT9V126_Y_RGB_OFFSET				0x337E
#define MT9V126_KERNEL_CONFIG				0x33F4

/* SOC2 Registers */
/* TODO */

/* SYSCTL Registers */
#define MT9V126_K22B_CHIP_ID				0x0000
#define MT9V126_PLL_DIVIDERS				0x0010
#define MT9V126_PLL_P_DIVIDERS				0x0012
#define MT9V126_PLL_CONTROL				0x0014
#define MT9V126_RESET_AND_MISC_CONTROL			0x001A
#define MT9V126_PAD_SLEW				0x0030
#define MT9V126_PAD_CONTROL				0x0032
#define MT9V126_PAD_GPI_STATUS				0x0034
#define MT9V126_COMMAND_REGISTER			0x0040

/* XDMA Registers */
#define MT9V126_ACCESS_CTL_STAT				0x0982
#define MT9V126_PHYSICAL_ADDRESS_ACCESS			0x098A
#define MT9V126_LOGICAL_ADDRESS_ACCESS			0x098E
#define MT9V126_MCU_VARIABLE_DATA_BASE			0x0990
#define MT9V126_MCU_VARIABLE_DATA(n)			\
	(MT9V126_MCU_VARIABLE_DATA_BASE + (n))

#define MT9V126_PHYSICAL_REGION_PATCH_RAM		0x0
#define MT9V126_PHYSICAL_REGION_SFR_RAM			0x2
#define MT9V126_PHYSICAL_REGION_OVERLAY_RAM		0x3

/* TX_SS Registers */
#define MT9V126_PARALLEL_BUS_CTRL			0x3C00
#define MT9V126_GPO					0x3C02
#define MT9V126_TVENC_CTRL_1				0x3C08
#define MT9V126_TVENC_CTRL_2				0x3C0A

/* OVERLAY_SS Registers */
/* TODO */

/* DEWARP_SS Registers */
/* TODO */

/* Variables */

/* AE_Track Variables */
#define MT9V126_AE_TRACK_MODE				0xA802
#define MT9V126_AE_TRACK_ALGO				0xA804
#define MT9V126_AE_TRACK_TARGET				0xA812
#define MT9V126_AE_TRACK_GATE				0xA814
#define MT9V126_AE_TRACK_JUMP_DIVISOR			0xA81A

/* AWB Variables */
#define MT9V126_AWB_R_SCENE_RATIO_LOWER			0xAC40
#define MT9V126_AWB_R_SCENE_RATIO_UPPER			0xAC42
#define MT9V126_AWB_B_SCENE_RATIO_LOWER			0xAC44
#define MT9V126_AWB_B_SCENE_RATIO_UPPER			0xAC46

/* Stat Variables */
#define MT9V126_STAT_INV_BRIGHTNESS_METRIC		0xB878
#define MT9V126_STAT_GAIN_METRIC			0xB87A

/* Low Light Variables */
#define MT9V126_LL_GAMMA_NRCURVE_0			0xBC32
#define MT9V126_LL_GAMMA_NRCURVE_1			0xBC34
#define MT9V126_LL_GAMMA_NRCURVE_2			0xBC36
#define MT9V126_LL_GAMMA_NRCURVE_3			0xBC38
#define MT9V126_LL_GAMMA_NRCURVE_4			0xBC3A
#define MT9V126_LL_GAMMA_NRCURVE_5			0xBC3C
#define MT9V126_LL_GAMMA_NRCURVE_6			0xBC3E
#define MT9V126_LL_GAMMA_NRCURVE_7			0xBC40
#define MT9V126_LL_GAMMA_NRCURVE_8			0xBC42
#define MT9V126_LL_GAMMA_NRCURVE_9			0xBC44
#define MT9V126_LL_GAMMA_NRCURVE_10			0xBC46
#define MT9V126_LL_GAMMA_NRCURVE_11			0xBC48
#define MT9V126_LL_GAMMA_NRCURVE_12			0xBC4A
#define MT9V126_LL_GAMMA_NRCURVE_13			0xBC4C
#define MT9V126_LL_GAMMA_NRCURVE_14			0xBC4E
#define MT9V126_LL_GAMMA_NRCURVE_15			0xBC50
#define MT9V126_LL_GAMMA_NRCURVE_16			0xBC52
#define MT9V126_LL_GAMMA_NRCURVE_17			0xBC54
#define MT9V126_LL_GAMMA_NRCURVE_18			0xBC56


/* Cam1Control Variables */
#define MT9V126_CAM1_SENSOR_0_FRAME_LENGTH_LINES	0xC812
#define MT9V126_CAM1_SENSOR_0_FINE_CORRECTION		0xC816

#define MT9V126_CAM1_SENSOR_0_MAX_FDZONE_0		0xC82E
#define MT9V126_CAM1_SENSOR_0_MAX_FDZONE_1		0xC830
#define MT9V126_CAM1_MAX_ANALOG_GAIN			0xC87C
#define MT9V126_CAM1_AET_SKIP_FRAMES			0xC89A
#define MT9V126_CAM1_AET_TARGET_FDZONE			0xC89C
#define MT9V126_CAM1_AET_TARGET_AGAIN			0xC89E

#define MT9V126_CAM1_AET_AE_MAX_VIRT_DGAIN		0xC8A4
#define MT9V126_CAM1_AET_AE_MAX_VIRT_AGAIN		0xC8A8
#define MT9V126_CAM1_AET_AE_VIRT_GAIN_TH_CG		0xC8AC
#define MT9V126_CAM1_AET_AE_VIRT_GAIN_TH_DCG		0xC8AE

#define MT9V126_CAM1_AET_EXT_GAIN_SETUP_0		0xC8BE
#define MT9V126_CAM1_AWB_CCM_L_0			0xC8CE
#define MT9V126_CAM1_AWB_CCM_L_1			0xC8D0
#define MT9V126_CAM1_AWB_CCM_L_2			0xC8D2
#define MT9V126_CAM1_AWB_CCM_L_3			0xC8D4
#define MT9V126_CAM1_AWB_CCM_L_4			0xC8D6
#define MT9V126_CAM1_AWB_CCM_L_5			0xC8D8
#define MT9V126_CAM1_AWB_CCM_L_6			0xC8DA
#define MT9V126_CAM1_AWB_CCM_L_7			0xC8DC
#define MT9V126_CAM1_AWB_CCM_L_8			0xC8DE
#define MT9V126_CAM1_AWB_CCM_L_9			0xC8E0
#define MT9V126_CAM1_AWB_CCM_L_10			0xC8E2
#define MT9V126_CAM1_AWB_CCM_RL_0			0xC8E4
#define MT9V126_CAM1_AWB_CCM_RL_1			0xC8E6
#define MT9V126_CAM1_AWB_CCM_RL_2			0xC8E8
#define MT9V126_CAM1_AWB_CCM_RL_3			0xC8EA
#define MT9V126_CAM1_AWB_CCM_RL_4			0xC8EC
#define MT9V126_CAM1_AWB_CCM_RL_5			0xC8EE
#define MT9V126_CAM1_AWB_CCM_RL_6			0xC8F0
#define MT9V126_CAM1_AWB_CCM_RL_7			0xC8F2
#define MT9V126_CAM1_AWB_CCM_RL_8			0xC8F4
#define MT9V126_CAM1_AWB_CCM_RL_9			0xC8F6
#define MT9V126_CAM1_AWB_CCM_RL_10			0xC8F8

#define MT9V126_CAM1_AWB_AWB_XSCALE			0xC910
#define MT9V126_CAM1_AWB_AWB_YSCALE			0xC912
#define MT9V126_CAM1_AWB_AWB_WEIGHTS_0			0xC914
#define MT9V126_CAM1_AWB_AWB_WEIGHTS_1			0xC916
#define MT9V126_CAM1_AWB_AWB_WEIGHTS_2			0xC918
#define MT9V126_CAM1_AWB_AWB_WEIGHTS_3			0xC91A
#define MT9V126_CAM1_AWB_AWB_WEIGHTS_4			0xC91C
#define MT9V126_CAM1_AWB_AWB_WEIGHTS_5			0xC91E
#define MT9V126_CAM1_AWB_AWB_WEIGHTS_6			0xC920
#define MT9V126_CAM1_AWB_AWB_WEIGHTS_7			0xC922
#define MT9V126_CAM1_AWB_AWB_XSHIFT_PRE_ADJ		0xC924
#define MT9V126_CAM1_AWB_AWB_YSHIFT_PRE_ADJ		0xC926


#define MT9V126_CAM1_LL_START_BRIGHTNESS		0xC930
#define MT9V126_CAM1_LL_STOP_BRIGHTNESS			0xC932
#define MT9V126_CAM1_LL_START_SATURATION		0xC934
#define MT9V126_CAM1_LL_END_SATURATION			0xC936
#define MT9V126_CAM1_LL_LL_START_0			0xC93C
#define MT9V126_CAM1_LL_LL_START_1			0xC93E
#define MT9V126_CAM1_LL_LL_START_2			0xC940
#define MT9V126_CAM1_LL_LL_STOP_0			0xC942
#define MT9V126_CAM1_LL_LL_STOP_1			0xC944
#define MT9V126_CAM1_LL_LL_STOP_2			0xC946
#define MT9V126_CAM1_LL_NR_START_0			0xC948
#define MT9V126_CAM1_LL_NR_START_1			0xC94A
#define MT9V126_CAM1_LL_NR_START_2			0xC94C
#define MT9V126_CAM1_LL_NR_START_3			0xC94E
#define MT9V126_CAM1_LL_NR_STOP_0			0xC950
#define MT9V126_CAM1_LL_NR_STOP_1			0xC952
#define MT9V126_CAM1_LL_NR_STOP_2			0xC954
#define MT9V126_CAM1_LL_NR_STOP_3			0xC956
#define MT9V126_CAM1_LL_START_GAMMA_BM			0xC958
#define MT9V126_CAM1_LL_STOP_GAMMA_BM			0xC95A

#define MT9V126_CAM1_LL_K_R_L				0xC962
#define MT9V126_CAM1_LL_K_G_L				0xC964
#define MT9V126_CAM1_LL_K_B_L				0xC966
#define MT9V126_CAM1_LL_K_R_R				0xC968
#define MT9V126_CAM1_LL_K_G_R				0xC96A
#define MT9V126_CAM1_LL_K_B_R				0xC96C

/* SysCtrl Variables */
#define MT9V126_SYS_REFRESH_MASK			0xDC28

/* Command Handler Variables */
#define MT9V126_CMD_HANDLER_PARAMS_POOL_BASE		0xFC00
#define MT9V126_CMD_HANDLER_PARAMS_POOL(n)		\
	(MT9V126_CMD_HANDLER_PARAMS_POOL_BASE+(n*2))


/* Host commands */
#define MT9V126_CMD_SYSMGR_SET_STATE			0x8100
#define MT9V126_CMD_SYSMGR_GET_STATE			0x8101
#define MT9V126_CMD_OVRL_ENABLE				0x8200
#define MT9V126_CMD_OVRL_GET_STATE			0x8201
#define MT9V126_CMD_DWRP_ENABLE				0x8300
#define MT9V126_CMD_DWRP_GET_STATE			0x8301
#define MT9V126_CMD_DWRP_CONFIG_STATUS			0x8303
#define MT9V126_CMD_DWRP_WRITE_CONFIG			0x8304
#define MT9V126_CMD_DWRP_APPLY_CONFIG			0x8305
#define MT9V126_CMD_GPIO_SET_PROP			0x8400
#define MT9V126_CMD_GPIO_GET_PROP			0x8401
#define MT9V126_CMD_SEQ_SET_ENCODING_MODE		0x8603
#define MT9V126_CMD_SEQ_SET_FLICKER_FREQ		0x8605
#define MT9V126_CMD_PATCHLDR_STATUS			0x8701
#define MT9V126_CMD_PATCHLDR_APPLY_PATCH		0x8702
#define MT9V126_CMD_PATCHLDR_PATCH_INFO			0x8704
#define MT9V126_CMD_TXMGR_CONFIG_DAC			0x8800
#define MT9V126_CMD_TXMGR_SET_PARALLEL_MODE		0x8801

#define MT9V126_INTERNAL_INIT_TIME			100

#define MT9V126_DEFAULT_K22B_CHIP_ID			0x2281
#define MT9V126_DEFAULT_MODEL_ID			0x2281

#define MT9V126_MAX_HEIGHT				640
#define MT9V126_MAX_WIDTH				480
#define MT9V126_MIN_HEIGHT				2
#define MT9V126_MIN_WIDTH				2
#define MT9V126_DEFAULT_WIDTH				640
#define MT9V126_DEFAULT_HEIGHT				480

#define MT9V126_COMMAND_DOORBELL			0x8000

#define MT9V126_ENOERR					0x00
#define MT9V126_ENOENT					0x01
#define MT9V126_EINTR					0x02
#define MT9V126_EIO					0x03
#define MT9V126_E2BIG					0x04
#define MT9V126_EBADF					0x05
#define MT9V126_EAGAIN					0x06
#define MT9V126_ENOMEM					0x07
#define MT9V126_EACCESS					0x08
#define MT9V126_EBUSY					0x09
#define MT9V126_EEXIST					0x0A
#define MT9V126_ENODEV					0x0B
#define MT9V126_EINVAL					0x0C
#define MT9V126_ENOSPC					0x0D
#define MT9V126_ERANGE					0x0E
#define MT9V126_ENOSYS					0x0F
#define MT9V126_EALREADY				0x10

#define MT9V126_PARAMS_POOL_SIZE			16
#define MT9V126_PATCHLDR_MAX_PATCHES			8

#define MT9V126_GPIO_PROP_OWNER				0x00
#define MT9V126_GPIO_PROP_DIRECTION			0x01
#define MT9V126_GPIO_PROP_ENABLE			0x02

#define MT9V126_OVRL_STREAM_INTERNAL			0x00
#define MT9V126_OVRL_STREAM_EXTERNAL			0x01
#define MT9V126_OVRL_MODE_NTSC				0x00
#define MT9V126_OVRL_MODE_PAL				0x01

#define MT9V126_TXMGR_PARALLEL_MODE_DISABLED		0x00
#define MT9V126_TXMGR_PARALLEL_MODE_OVERLAY_BT656	0x10
#define MT9V126_TXMGR_PARALLEL_MODE_DEWARP_BT656	0x20
#define MT9V126_TXMGR_PARALLEL_MODE_CPIPE		0x30
#define MT9V126_TXMGR_PARALLEL_MODE_DEWARP_PROGRESSIVE	0x40
#define MT9V126_TXMGR_PARALLEL_MODE_TEST_PATTERN	0x50
#define MT9V126_TXMGR_PARALLEL_MODE_SENSOR_RAW10	0x60
#define MT9V126_TXMGR_PARALLEL_MODE_RECONSTRUCT_8_2	0x70

#define MT9V126_SYS_STATE_UNCONFIGURED			0x23
#define MT9V126_SYS_STATE_ENTER_STREAMING		0x30
#define MT9V126_SYS_STATE_STREAMING			0x31
#define MT9V126_SYS_STATE_ENTER_SUSPEND			0x40
#define MT9V126_SYS_STATE_SUSPENDED			0x41
#define MT9V126_SYS_STATE_ENTER_STANDBY			0x50
#define MT9V126_SYS_STATE_STANDBY			0x51
/* What is state 0x52? */
#define MT9V126_SYS_STATE_LEAVE_STANDBY			0x54

struct mt9v126_patch {
	u16 code_addr;
	u16 loader_addr;
	u16 id;
	u32 fw_version;
	u16 code_size;
	/* The effective array size MUST be a multiple of 2. */
	const u8 *code;
};

extern const struct mt9v126_patch *mt9v126_patches[];

struct mt9v126_dewarp {
	u8 type;
	u16 size;
	/* The effective array size MUST be a multiple of 2. */
	const u8 *data;
};

extern const struct mt9v126_dewarp mt9v126_dewarp_config_pal_640x480;
extern const struct mt9v126_dewarp mt9v126_dewarp_config_p25_640x480_46;
extern const struct mt9v126_dewarp mt9v126_dewarp_config_p30_640x480_46;

#endif /* _MT9V126_DRIVER_H */
